{% extends "base.html" %}

{% block title %}Buscador - {{ app_nombre }}{% endblock %}

{% block content %}
<div class="row justify-content-center mt-4">
  <div class="col-md-10">
    <h2 class="mb-4">Resultados de búsqueda</h2>

    <form method="get" action="{{ url_for('buscar') }}" class="row g-3 mb-4">
      <div class="col-md-4">
        <label for="texto_libre" class="form-label">Texto libre</label>
        <input type="text" class="form-control" id="texto_libre" name="texto_libre"
               value="{{ termino or '' }}">
      </div>
      <div class="col-md-3">
        <label for="autor" class="form-label">Autor</label>
        <input type="text" class="form-control" id="autor" name="autor"
               value="{{ autor or '' }}">
      </div>
      <div class="col-md-2">
        <label for="anio_desde" class="form-label">Año desde</label>
        <input type="number" class="form-control" id="anio_desde" name="anio_desde"
               value="{{ anio_desde or '' }}">
      </div>
      <div class="col-md-2">
        <label for="anio_hasta" class="form-label">Año hasta</label>
        <input type="number" class="form-control" id="anio_hasta" name="anio_hasta"
               value="{{ anio_hasta or '' }}">
      </div>
      <div class="col-md-1 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Buscar</button>
      </div>
    </form>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if total_resultados is not none %}
    <p><strong>Total de resultados:</strong> {{ total_resultados }}</p>
    {% endif %}

    {% if resultados %}
      <ul class="list-group mt-3">
        {% for libro in resultados %}
        <li class="list-group-item bg-dark text-light mb-2">
          <h5 class="mb-1">{{ libro.titulo }}{% if libro.anio %} ({{ libro.anio }}){% endif %}</h5>
          <p class="mb-1"><strong>Autor:</strong> {{ libro.autor or 'Desconocido' }}</p>
          {% if libro.descripcion %}
          <p class="mb-1">{{ libro.descripcion }}</p>
          {% endif %}
          {% if libro.archivo %}
          <small>Archivo: {{ libro.archivo }}</small>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    {% else %}
      {% if not error %}
      <p class="mt-3">No se encontraron libros con esos filtros.</p>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
